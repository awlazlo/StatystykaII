---
title: "Projekt 1 Faza 3"
author: "Dominik Ambroziak, Mateusz Jastrz¹b, Patrycja Matys, Kamil Wirtek"
date: "29 kwietnia 2016"
output: 
  html_document:
    fig_caption: yes

---

##Temat B. Segmentacja zwiedzaj¹cych. 

###Spis treœci:
#### 1. Podzia³ wizytuj¹cych pod wzglêdem liczby odwiedzanych eksponatów - analiza korespondencji.
#### 2. Grupowanie odwiedzaj¹cych za pomoc¹ algorytmu k-œrednich.

```{r myfile-12-plot, echo = F, results = 'asis'}
cat('\n![ ](enter.png)\n')
``` 

### 1. Podzia³ wizytuj¹cych pod wzglêdem liczby odwiedzanych eksponatów

###Pytanie:
<h4>Poni¿ej zobaczymy rozk³ad popularnoœci stacji i stref ogólem, ale pojawia siê pytanie, czy rozk³ad popularnoœci jest inny dla poszczególnych podgrup zwiedzaj¹cych?
Czy istniej¹ zale¿noœci i je¿eli tak to jakie, miêdzy:

a) podgrupami zwiedzaj¹cych i stacjami,

b) podgrupami zwiedzaj¹cych i strefami?

</h4>


<center>
```{r, echo = F,warning=FALSE}

load(file="tab_bin_zsuma.RData")
library(ggplot2)
g<-ggplot(tab_bin_zsuma, aes(tab_bin_zsuma$suma,fill=tab_bin_zsuma$V60)) + geom_bar()+scale_y_continuous(breaks=seq(0,20000,5000)) + xlim(0,40) + xlab("Iloœæ odwiedzonych stacji") +ylab("Iloœæ zwiedzaj¹cych")+ ggtitle("Iloœæ odwiedzonych stacji")+ guides(fill=guide_legend(title=NULL))
g + theme(aspect.ratio = 1/2)
```  

</center>

```{r, warning=FALSE, eval=FALSE}
load(file="tab_bin_zsuma.RData")
library(ggplot2)
g<-ggplot(tab_bin_zsuma, aes(tab_bin_zsuma$suma,fill=tab_bin_zsuma$V60)) + geom_bar()+scale_y_continuous(breaks=seq(0,20000,5000)) + xlim(0,40) + xlab("Iloœæ odwiedzonych stacji") +ylab("Iloœæ zwiedzaj¹cych")+ ggtitle("Iloœæ odwiedzonych stacji")+ guides(fill=guide_legend(title=NULL))
g + theme(aspect.ratio = 1/2)
``` 

Grupê wszystkich zwiedzaj¹cych podzieliliœmy na 4 podgrupy (kwartyle):

* osoby, które odwiedzi³y od 1 do 2 stacji

* osoby, które odwiedzi³y od 3 do 5 stacji

* osoby, które odwiedzi³y od 6 do 9 stacji

* osoby, które odwiedzi³y co najmniej 10 stacji

<center>
```{r, echo = F,warning=FALSE}
load(file="tabela_kwartyl.RData")
library(ggplot2)
kwartyle_tab<- (table(tabela_kwartyl$kwartyl))
kwartyle_tab<- data.frame(kwartyle_tab)
kwartyle_tab[,1]<-c("grupa 1","grupa 2","grupa 3","grupa 4")
row.names(kwartyle_tab) <-c("Od 1 do 2 stacji", "Od 3 do 5 stacji", "Od 6 do 9 stacji", "Powyzej 10 stacji")
colnames(kwartyle_tab)[2]<- "Ilosc"
colnames(kwartyle_tab)[1]<- "Grupa"
g<-ggplot(kwartyle_tab,aes(x=row.names(kwartyle_tab),y=kwartyle_tab$Ilosc,fill=kwartyle_tab$Grupa)) + geom_bar(stat="identity",colour="black")+xlab("Podgrupa") + ylab("Iloœæ zwiedzaj¹cych") + ggtitle("Wielkoœci podgrup") + geom_text(aes(label=kwartyle_tab$Ilosc),vjust=1.2) + guides(fill=FALSE)
g + theme(aspect.ratio = 1/2)
``` 

</center>

```{r, warning=FALSE, eval=FALSE}
load(file="tabela_kwartyl.RData")
library(ggplot2)
kwartyle_tab<- (table(tabela_kwartyl$kwartyl))
kwartyle_tab<- data.frame(kwartyle_tab)
kwartyle_tab[,1]<-c("grupa 1","grupa 2","grupa 3","grupa 4")
row.names(kwartyle_tab) <-c("Od 1 do 2 stacji", "Od 3 do 5 stacji", "Od 6 do 9 stacji", "Powyzej 10 stacji")
colnames(kwartyle_tab)[2]<- "Ilosc"
colnames(kwartyle_tab)[1]<- "Grupa"
g<-ggplot(kwartyle_tab,aes(x=row.names(kwartyle_tab),y=kwartyle_tab$Ilosc,fill=kwartyle_tab$Grupa)) + geom_bar(stat="identity",colour="black")+xlab("Podgrupa") + ylab("Iloœæ zwiedzaj¹cych") + ggtitle("Wielkoœci podgrup") + geom_text(aes(label=kwartyle_tab$Ilosc),vjust=1.2) + guides(fill=FALSE)
g + theme(aspect.ratio = 1/2)
``` 


Sprawdziliœmy iloœæ odwiedzin poszczególnych stacji (popularnoœæ stacji) w grupie wszystkich zwiedzaj¹cych:
<center>
 
```{r, echo = F,warning=FALSE}
load(file="popularnosc_stacji_tab.RData")
library(ggplot2)
g<-ggplot(popularnosc_stacji_tab,aes(y=popularnosc_stacji_tab$popularnosc_stacji,x=popularnosc_stacji_tab$V2))+geom_bar(stat="identity", fill="royalblue2") + scale_y_continuous(breaks=seq(0,50000,10000))+ xlab("Stacje") +ylab("Iloœæ zwiedzaj¹cych")+ggtitle("Popularnoœæ stacji")+theme(axis.text.x = element_text(angle = 90, hjust = 1))
g + theme(aspect.ratio = 1/2)
```

</center>

> Do utworzenia powy¿szego histogramu potrzebujemy tabeli popularnosc_stacji_tab,
> kod pokazuj¹cy jak utworzyliœmy tê tabelê jest umieszczony w Dodatku.

Sprawdziliœmy iloœæ odwiedzin stacji z poszczególnych stref (popularnoœæ stref) w grupie wszystkich zwiedzaj¹cych:

<center>
```{r, echo = F,warning=FALSE}
load(file="wektor_tab.RData")
library(ggplot2)
g<-ggplot(wektor_tab,aes(x=wektor_tab$V2,y=wektor_tab$wektor))+geom_bar(stat="identity",fill="royalblue2",colour="black") +xlab("Strefy") + ylab("Iloœæ zwiedzaj¹cych") + ggtitle("Popularnoœæ stref")+ geom_text(aes(label=wektor_tab$wektor), vjust=1.1) 
g + theme(aspect.ratio = 1/2)
```

</center>

> Do utworzenia powy¿szego histogramu potrzebujemy tabeli wektor_tab,
> kod pokazuj¹cy jak utworzyliœmy tê tabelê jest umieszczony w Dodatku.

Aby sprawdziæ niezale¿noœæ dla powy¿szych dwóch par zmiennych jakoœciowych wykorzystamy analizê korespondencji.

<h2>Analiza korespondencji</h2>

(Analiza korespondencji dla dwóch par zmiennych jakoœciowych:
kwartyle i stacje oraz kwartyle i strefy. Dla stacji mamy 59 poziomów dla stref mamy 4 poziomy.)

<h3>Problem</h3>

Obserujemy dwie pary zmiennych jakoœciowych. Interesuje nas, czy zmienne te s¹ od siebie niezale¿ne, a je¿eli nie s¹ niezale¿ne, to które kombinacje poziomów wystêpuj¹ ze sob¹ znacznie czêœciej.

Dane z którymi mamy do czynienia to dwie macierze o wymiarach 4x4 oraz 59x4.

<center>
```{r, echo = F,warning=FALSE}

load(file="tabela_kwartyl_stacja_strefa.RData")
(dane_strefa <- xtabs(~ strefa + kwartyl, tabela_kwartyl_stacja_strefa, drop.unused.levels = TRUE))
dane_stacja <- xtabs(~ stacja + kwartyl, tabela_kwartyl_stacja_strefa, drop.unused.levels = TRUE)
head(dane_stacja)
```

</center>

> Do pokazania powy¿szych macierzy potrzebujemy tabeli tabela_kwartyl_stacja_strefa,
> kod pokazuj¹cy jak utworzyliœmy te macierze jest umieszczony za materia³em przedstawiaj¹cym Analizê korespondencji.

<h3>Rozwi¹zanie problemu</h3>

Aby oceniæ, które zmienne wystêpuj¹ czêœciej ze sob¹ wykonamy analizê korespondencji. Je¿eli zmienne by³yby niezale¿ne od siebie, to zachodzi³oby równanie:

$$p_{ij}=p_{i.}p_{·j}$$  

gdzie $p_{ij}$ to prawdopodobienstwo zaobserwowania pierwszej zmiennej na poziomie $i$ oraz jednoczesnie drugiej na poziomie $j$, $p_{i.}$ to prawdopodobienstwo zaobserwowania zmiennej pierwszej na poziomie $i$, a $p_{·j}$ to prawdopodobienstwo zaobserwowania zmiennej drugiej na poziomie $j$.

¯eby oceniæ, które zmienne wystêpuj¹ czêœciej lub rzadziej ni¿ wynika³o by to z niezale¿noœci, porównamy dwie metody. Pierwsza to stworzenie macierzy residuow Pearsonowskich, druga to wykorzystanie funkcji ca(). 

Dla pierwszej metody wyznaczamy standaryzowane reszty Pearsonowskie, zast¹pimy te¿ prawdopodobieñstwa ich czestosciowymi ocenami (czyli $\hat{p}$ to liczba obserwowanych zdarzeñ podzielona przez liczbê wszystkich obserwowanych zdarzeñ)


$$\hat{e}_{ij}=\frac{\hat{p}_{ij}-\hat{p}_{i.}\hat{p}_{·j}}  {\hat{p}_{i.}\hat{p}_{·j}}$$

Duze dodatnie wartosci $\hat{e}_{ij}$ odpowiadaj¹ wysokiemu wspó³wystepowaniu, ujemne wartosci odpowiadaja wystepowaniu rzadszemu niz losowe.

<h3>Analiza korespondencji z macierz¹ reszt Pearsonowskich E</h3>

```{r,warning=FALSE}
load(file="dane_stacja_strefa.RData")
# Zobaczmy które kombinacje wystepuja czesciej niz w przypadku niezaleznosci
 # Policzmy residua Pearsonowskie
P = dane_strefa/sum(dane_strefa)
P_s = dane_stacja/sum(dane_stacja)
# Macierz czestosci oczekiwanych
PP = outer(rowSums(P),colSums(P))
PP_s = outer(rowSums(P_s),colSums(P_s))
# Macierz residuow Pearsonowskich
E = (P-PP)/sqrt(PP)
E_s = (P_s-PP_s)/sqrt(PP_s)
```

<center>

```{r,warning=FALSE,message=FALSE}
load(file="E_s.RData")
load(file="E.RData")
library(RColorBrewer)
kolory = rev(brewer.pal(11,"Spectral"))
# Macierz E przedstawmy za pomoca mapy ciep³a
library(gplots)
heatmap.2(x=E_s, Colv=NA, 
          col = kolory, 
          scale="none",
          margins=c(1,0), 
          trace='none', 
          cexRow=17/27,
          cexCol=1,
          symkey=FALSE, 
          symbreaks=FALSE, 
          dendrogram='none',
          denscol="black",offsetCol=-0.5,
          srtRow=0, 
          srtCol=0,
          key.par=list(mar=c(3.5,0,3,0)),
          lmat=rbind(c(5, 4, 2), c(6, 1, 3)), 
          lhei=c(2.5, 5), 
          lwid=c(1, 10, 1))

heatmap.2(x=E, Colv=NA, 
          col = kolory, 
          scale="none",
          margins=c(1,1), 
          trace='none', 
          cexRow=1,
          cexCol=1,
          symkey=FALSE, 
          symbreaks=FALSE, 
          dendrogram='none',
          denscol="black",
          offsetCol=-0.5,
          offsetRow=-0.5,
          srtRow=0, 
          srtCol=0, 
          key.par=list(mar=c(3.5,0,3,0)),
          lmat=rbind(c(5, 4, 2), c(6, 1, 3)), 
          lhei=c(2.5, 5), 
          lwid=c(1, 10, 1))


```

</center>

> Do utworzenia powy¿szej mapy potrzebujemy tabeli dane_stacja_strefa,
> kod pokazuj¹cy jak utworzyliœmy tê tabelê jest umieszczony za materia³em przedstawiaj¹cym Analizê korespondencji.

Wyznaczyliœmy macierz reszt Pearsonowskich E (któr¹ tez przedstawiliœmy graficznie z u¿yciem mapy ciep³a) i z tej macierzy mo¿emy ju¿ odczytaæ, w których kwartylach/podgrupach poszczególne strefy i stacje s¹ popularniejsze. Powtórzmy: dodatnie wartoœci reszt odpowiadaj¹ wy¿szemu wspó³wystepowaniu, ujemne wartosci odpowiadaja wystepowaniu rzadszemu, ni¿ losowe.

Stacje: Najwieksze reszty dodatnie obserwujemy dla podgrupy (0,2] (w stacjach 25 oraz 19a), a najwiêksze ujemne wartosci obserwujemy dla podgrupy (9,51] (równie¿ w stacjach 25 oraz 19a). To oznacza, ¿e liczba odwiedzin stacji 25 oraz 19a przez osoby z podgrupy (0,2] jest stosunkowo du¿a na tle pozosta³ych podgrup. Oraz liczba odwiedzin stacji 25 oraz 19a przez osoby z podgrupy (9,51] jest stosunkowo niska na tle pozosta³ych podgrup. 

Strefy: Najwieksze reszty obserwujemy dla podgrupy (0,2], zarówno duze dodatnie wartosci (w strefie JA_TY) jak i duze (co do modu³u) ujemne wartosci (JA_MY_ONI). To oznacza, ¿e liczba odwiedzin strefy JA_TY przez osoby z tej podgrupy jest stosunkowa du¿a na tle innych podgrup, a JA_MY_ONI stosunkowo niska. Du¿¹ resztê dodatni¹ mamy równie¿ dla podgrupy (9,51] (w strefie JA_MY_ONI).

<h3>Analiza korespondencji z uzyciem pakietu ca </h3>
<center>
```{r,warning=FALSE,fig.width=10, fig.height=8}
load(file="dane_stacja_strefa.RData")
library(ca)
plot(ca(dane_stacja), mass=c(T,T))
```

</center>

> Do pokazania powy¿szych danych potrzebujemy tabeli dane_stacja_strefa,
> kod pokazuj¹cy jak utworzyliœmy tê tabelê jest umieszczony za materia³em przedstawiaj¹cym Analizê korespondencji.

Stacje: Analizuj¹c ten wykres mo¿na zauwa¿yæ ciekawe zró¿nicowanie stref. Na osi X najwiêksz¹ ujemn¹ wspó³rzêdn¹ ma zmienna (0,2], a wiêc to ta zmienna odpowiada najwiêkszemu zró¿nicowaniu stacji. Niskie wartoœci na tej osi osi¹gaj¹ stacje, które s¹ charakterystyczne dla osób z podgrupy (0,2]. Dodatnie wartoœci na tej osi osi¹gaj¹ stacje, które s¹ charakterystyczne dla zwiedzaj¹cych z podgrupy (9,51]. Druga oœ rozró¿nia strefy, charakterystyczne dla zwiedzaj¹cych z podgrupy (2,5] versus (0,2]. 

Stacja 25 jest charakterystyczna dla zwiedzaj¹cych z podgrupy (0,2]. Stacje 19b, 02a, 02b dla podgrupy (2,5], stacje 42 oraz 18 dla podgrupy (5,9]. Widzimy du¿¹ liczbê stacji maj¹cych wspó³rzêdn¹ x dodatni¹, st¹d wnioskujemy, ¿e te stacje s¹ odwiedzane przez podgrupê (9,51] jednak wspó³rzêdne tych wszystkich stacji s¹ do siebie zbli¿one.

<center>
```{r,warning=FALSE}
load(file="dane_stacja_strefa.RData")
library(ca)
plot(ca(dane_strefa), mass=c(T,T))
```

</center>

> Do pokazania powy¿szych danych potrzebujemy tabeli dane_stacja_strefa,
> kod pokazuj¹cy jak utworzyliœmy tê tabelê jest umieszczony za materia³em przedstawiaj¹cym Analizê korespondencji.

Strefy: Analizuj¹c ten wykres mo¿na zauwa¿yæ zró¿nicowanie oraz rozmieszczenie kwartyli/podgrup analogiczne jak w przypadku stacji.

Strefa JA jest charakterystyczna dla osób z podgrupy (2,5] oraz (5,9]. Strefy JA_SWIAT oraz JA_MY_ONI dla podgrupy (9,51], a strefa JA_TY dla podgrupy (0,2]. </center>

<h3>Porównanie metod:</h3>

1) Stacje

A) Macierz reszt Pearsonowskich: 
Widzimy, ¿e najwiêksze reszty maj¹ stacje 25 oraz 19a dla podgrupy (0,2] oraz najmniejsze reszty dla podgrupy (9,51]. Tylko te dwie stacje s¹ wyró¿nione w tej metodzie. 

B) Pakiet ca: 
Dla tej metody równie¿ widzimy, ¿e stacja 25 oraz 19a s¹ wyró¿nione. S¹ to stacje najbli¿ej po³o¿one podgrupy (0,2] oraz najdalej (9,51].

2) Strefy

A) Macierz reszt Pearsonowskich: 
Widzimy, ¿e najwiêksze reszty ma strefa JA_TY dla podgrupy (0,2] oraz JA_MY_ONI dla podgrupy (9,51]. Najmniejsze reszty ma strefa JA_MY_ONI dla podgrupy (0,2] oraz (2,5]. 

B) Pakiet ca: 
Strefa JA_TY jest najbardziej wyró¿niona na wykresie (przyjmuje najwiêksze wartoœci co do modu³u) oraz jest najbli¿ej podgrupy (0,2]. Strefa JA_MY_ONI przymuje najwiêksze wartoœci na osi X i dla niej najbli¿sz¹ podgrup¹ jest (9,51]. Widzimy te¿, ¿e patrz¹c wzglêdem osi X, podgrupami najdalej po³o¿onymi od strefy JA_MY_ONI s¹ podgrupy (0,2] oraz (2,5]. 

__Podsumowuj¹c__, wyniki obu metod s¹ podobne, w rezultacie trudno oceniæ, która jest lepsza. Aby dok³adniej przyjrzeæ siê wynikom Analizy korespondencji w Dodatku zamieœciliœmy odpowiedniki histogramów "Popularnoœæ stacji" oraz "Popularnoœæ stref" w podziale na otrzymane podgrupy (dane histogramy by³y zamieszczone w fazie 2). Mo¿na tam zauwa¿yæ potwierdzenie naszych wyników, m. in. dla podgrupy (0,2] najwiêksze wartoœci przyjmuj¹ stacje 19a oraz 25. W pogrupie (9,51] stacja 25 przyjmuje niskie wartoœci, a stacja 19a chocia¿ ma wysokie wartoœci, to wiele stacji ma zbli¿ony do niej wynik. Podobne potwierdzenie znajdujemy dla stref: w porównaniu do innych podgrup, dla podgrupy (0,2] obserwujemy, ¿e strefa JA_TY przyjmuje wiêksze wartoœci, a strefa JA_MY_ONI mniejsze. Oraz dla podgrupy (9,51] widzimy, ¿e stefa JA_MY_ONI przyjmuje zbli¿ony wynik do najpopularniejszej strefy JA.

###Kod do Analizy korespondencji:

```{r, warning=FALSE, eval=FALSE}
#³adujemy potrzebn¹ tabelê, która dla poszczególnego zwiedzaj¹cego mówi, czy podchodzi³ do konkretnego eksponatu czy nie
load(file="tabela_station_strefa_sort_b.RData")

#dodajemy kolumnê pokazuj¹c¹ do ilu eksponatów podchodzi³ poszczególny zwiedzaj¹cy
tabela_station_strefa_sort_b$suma<-rowSums(sapply(tabela_station_strefa_sort_b[,2:58],as.numeric))

#sprawdzamy jakie s¹ kwartyle dla danych z ostatnio dodanej kolumny
summary(tabela_station_strefa_sort_b$suma)

#dodajemy kolumnê okreœlaj¹c¹ przynale¿noœæ do podgrupy/kwartyla
tabela_station_strefa_sort_b$kwartyl <- cut(tabela_station_strefa_sort_b$suma, c(0,2,5,9,51))
str(tabela_station_strefa_sort_b)
#tworzymy tabelê zawieraj¹c¹ numer zwiedzaj¹cego i przynale¿noœæ do kwartyla/podgrupy
tabela_kwartyl<-tabela_station_strefa_sort_b[,c(1,60)]

#z tabeli SmallLogs stworzyliœmy tabelê "visitor_station_strefa" mówi¹c¹ w jakich strefach i stacjach/eksponatach by³ dany zwiedzaj¹cy
load(file="visitor_station_strefa.RData")

#do tabeli tabela_kwartyl do³¹czamy informacje o strefach i stacjach/eksponatach
tabela_kwartyl_stacja_strefa<-merge(x = tabela_kwartyl, y = visitor_station_strefa, by = "visitor")

(dane_strefa <- xtabs(~ strefa + kwartyl, tabela_kwartyl_stacja_strefa, drop.unused.levels = TRUE))
dane_stacja <- xtabs(~ stacja + kwartyl, tabela_kwartyl_stacja_strefa, drop.unused.levels = TRUE)
head(dane_stacja)
save(dane_stacja,dane_strefa, file="dane_stacja_strefa.RData")

library(RColorBrewer)
#tworzymy wektor kolorów

kolory = rev(brewer.pal(11,"Spectral"))

P = dane_strefa/sum(dane_strefa)
P_s = dane_stacja/sum(dane_stacja)
PP = outer(rowSums(P),colSums(P))
PP_s = outer(rowSums(P_s),colSums(P_s))
E = (P-PP)/sqrt(PP)
E_s = (P_s-PP_s)/sqrt(PP_s)

#przedstawiamy macierz E za pomoc¹ mapy ciep³a
library(gplots)
heatmap.2(x=E_s, Colv=NA, 
          col = kolory, 
          scale="none",
          margins=c(1,0), 
          trace='none', 
          cexRow=17/27,
          cexCol=1,
          symkey=FALSE, 
          symbreaks=FALSE, 
          dendrogram='none',
          denscol="black",offsetCol=-0.5,
          srtRow=0, 
          srtCol=0,
          key.par=list(mar=c(3.5,0,3,0)),
          lmat=rbind(c(5, 4, 2), c(6, 1, 3)), 
          lhei=c(2.5, 5), 
          lwid=c(1, 10, 1))

heatmap.2(x=E, Colv=NA, 
          col = kolory, 
          scale="none",
          margins=c(1,1), 
          trace='none', 
          cexRow=1,
          cexCol=1,
          symkey=FALSE, 
          symbreaks=FALSE, 
          dendrogram='none',
          denscol="black",
          offsetCol=-0.5,
          offsetRow=-0.5,
          srtRow=0, 
          srtCol=0, 
          key.par=list(mar=c(3.5,0,3,0)),
          lmat=rbind(c(5, 4, 2), c(6, 1, 3)), 
          lhei=c(2.5, 5), 
          lwid=c(1, 10, 1))

#dodatkowe mapy ciep³a niewykorzystane do projektu
heatmap(E,scale="row",Colv=NA, col= kolory)
heatmap(E_s,scale="row",Colv=NA, col= kolory)
heatmap(E,scale="col",Colv=NA, col= kolory)
heatmap(E_s,scale="col",Colv=NA, col= kolory)

#pakiet ca
library(ca)
plot(ca(dane_strefa), mass=c(T,T)) 
plot(ca(dane_stacja), mass=c(T,T)) 
 
```

```{r myfile-16-plot, echo = F, results = 'asis'}
cat('\n![ ](enter.png)\n')
``` 

<h1>2. Grupowanie odwiedzaj¹cych za pomoc¹ algorytmu k-œrednich</h1>

<h3>Teraz nie chcemy przyjmowaæ ¿adnych wstêpnych za³o¿eñ o odwiedzaj¹cych. Za pomoc¹ algorytmu k-œrednich bêdziemy chcieli dokonaæ podzia³u ca³ej populacji odwiedzaj¹cych. Kieruj¹ nami nastêpuj¹ce pytania.</h3>

1. Czy s¹ grupy odwiedzaj¹cych, preferuj¹cych pewien podzbiór eksponatów?

2. Czy te grupy maj¹ cechy charakterystyczne (inne ni¿ podzbiór preferowanych eksponatów)?

3. Czy preferowane eksponaty dla danej grupy maj¹ cechy wspólne?

Bêdziemy pracowaæ na tabeli danych __„populacja”__ zawieraj¹c¹ informacje o 158 495 odwiedzaj¹cych. Interesuje nas jedynie czy odwiedzaj¹cy skorzysta³ ze stacji. Abstrahujemy od czasu korzystania ze stacji. W tym celu stworzyliœmy binarn¹ tabele, w której  wiersze odpowiadaj¹ id odwiedzaj¹cego, a kolumny stacj¹.  Przypisujemy wartoœæ __populacja__[i,j]=1 jeœli odwiedzaj¹cy   __i__ skorzysta³ ze stacji __j__, __populacja__[i,j]=0 w p.p.. Tabela wygl¹da nastêpuj¹co.

<center>

```{r myfile-1-plot, echo = F, results = 'asis'}
cat('\n![Tabela 1.](Tabela_do_prezentacji.png)\n')
```

</center>

<h3>Klastracja</h3> 
Dla takich danych dokonujemy podzia³u populacji na 5 grup za pomoc¹ algorytmu k-œrednich. 

```{r, warning=FALSE, eval=FALSE}
load(file="populacja.RData")
library(cluster)
library(ggplot2)
pogrupowanie<-kmeans(populacja[,2:58],5) 
populacja$grupa<-factor(pogrupowanie$cluster)
pogrupowanie$size
```

Otrzymane grupy maj¹ nastêpuj¹c¹ licznoœci:
<center>
```{r, echo = F,warning=FALSE}
load(file="populacja2.RData")
ggplot(populacja2,aes(grupa, fill=grupa))+geom_bar()
```

</center>
Dla ka¿dego takiego podzia³u wybieramy do dalszego opisu 10 najbardziej i najmniej popularnych stacji. Szczegó³owe informacje o nich jak i o grupach zawiera poni¿sza tabela:

<center>
```{r myfile-2-plot, echo = F, results = 'asis'}
cat('\n![Tabela 2.](Tabela_o_grupach.png)\n')
```

</center>

<h4>Kolumny powy¿szej tabeli zawieraj¹ nastêpuj¹ce informacje:</h4>

* __n__  o liczbie osób nale¿¹cych do grupy 
  
* __10 Najczêœciej Odwiedzanych Stacji__ zawiera listê najbardziej popularnych stacji w grupie
  
* __Ile Osób__ o procencie osób z grupy, którzy odwiedzili dan¹ maszynê (szereguje stacje wg popularnoœci)
  
* __Strefa__ z jakiego obszaru tematycznego pochodzi stacja
  
* __10 Najrzadziej Odwiedzanych Stacji__ zawiera listê najmniej popularnych stacji
  
* __Weekend__ o procencie osób z grupy, którzy odwiedzili CNK w weekend
  
  <h3>Diagnostyka</h3>
  
$1.$ Sylwetki grup
  
Do diagnostyki naszego grupowania wykorzystamy sylwetki. Ka¿demu obiektowi i przypisujemy wartoœæ __s(i)__. Im bli¿sza __s(i)__ wartoœci 1, tym bardziej dany obiekt pasuje do swojej grupy, im bli¿sza wartoœci -1, tym bli¿ej temu obiektowi do grupy s¹siedniej.  
<center>

```{r myfile-10-plot, echo = F, results = 'asis'}
cat('\n![ ](Sylwetka1.png)\n')
```

</center>

```{r, warning=FALSE, eval=FALSE}
load(file="populacja.RData")
load(file="pogrupowanie.RData")
library(cluster)
library(factoextra)
odleglosci<-dist(populacja[0:100,2:58],"manhattan")
sylwetka <- silhouette(pogrupowanie$cluster[0:100],odleglosci )
sylwetka[1:20,]
fviz_silhouette(sylwetka)
```

Wykres sylwetek podwa¿a stabilnoœæ dla grup 3, 4 i 5. Mog³o by to sugerowaæ ograniczenie liczby grup, jednak takie dzia³anie  przynosi podobny wynik.
<center>


```{r myfile-11-plot, echo = F, results = 'asis'}
cat('\n![ ](Sylwetka2.png)\n')
cat('\n![ ](Sylwetka3.png)\n')
```

</center>

```{r, warning=FALSE, eval=FALSE}
load(file="populacja.RData")
load(file="populacja2.RData")
library(cluster)
library(factoextra)
km_diag2<-kmeans(populacja2[,2:58],2)
km_diag3<-kmeans(populacja2[,2:58],3)
odleglosci<-dist(populacja[0:100,2:58],"manhattan")
sylwetka <- silhouette(km_diag2$cluster[1:100],odleglosci )
sylwetka[1:50,]
fviz_silhouette(sylwetka)

sylwetka <- silhouette(km_diag3$cluster[1:100],odleglosci )
sylwetka[1:50,]
fviz_silhouette(sylwetka)
```

$2.$ Miara Rand’a

Jest to miara podobieñstwa dwóch partycji danych. Mamy zbiór n-elementowy $S=\{e_1,…e_n\}$ oraz dwa podzia³y tego zbioru $X=\{X_1,…,X_r\}$ (podzia³ S na r podzbiorów) i $Y=\{Y_1,..,Y_t\}$ (podzia³ S na t podzbiorów}. Definiujemy:

* a – liczba par ze zbioru S, które s¹ w tych samych zbiorze podzia³u X i w tym samym zbiorze podzia³u Y

* b – liczba parze zbioru S, które s¹ w ró¿nych zbiorach podzia³u X i ró¿nych zbiorach podzia³u Y

Miara Rand’a $r$ to $$r=\frac{a+b}{{n}\choose{2}}$$

Miara randa przyjmuje wartoœci z zakresu [0,1].  Wartoœæ zero oznacza, ¿e dwa podzia³y nie zgadzaj¹ siê dla ¿adnej pary, wartoœæ 1 oznacza podzia³y s¹ dok³adnie takie same. Do obliczenia miary Rand’a wykorzystamy pakiet __fossil__.
  
Dla tej samej zbiorowoœci wygenerowaliœmy podzia³y na 2, 3, 4, 6 oraz 7 grup.

```{r, warning=FALSE, eval=FALSE}
load(file="populacja.RData")
load(file="populacja2.RData")
library(factoextra)
km_diag2<-kmeans(populacja2[,2:58],2)
km_diag3<-kmeans(populacja2[,2:58],3)
km_diag4<-kmeans(populacja2[,2:58],4)
km_diag6<-kmeans(populacja2[,2:58],6)
km_diag7<-kmeans(populacja2[,2:58],7)

rand.index(km_diag2$cluster[2000:4000],pogrupowanie$cluster[2000:4000])
rand.index(km_diag3$cluster[4000:6000],pogrupowanie$cluster[4000:6000])
rand.index(km_diag4$cluster[6000:8000],pogrupowanie$cluster[6000:8000])
rand.index(km_diag6$cluster[10000:12000],pogrupowanie$cluster[10000:12000])
rand.index(km_diag7$cluster[12000:14000],pogrupowanie$cluster[12000:14000])
```

Otrzymaliœmy nastêpuj¹ce wartoœci miary Rand’a dla naszego pierwotnego podzia³u oraz podzia³u:
 
* 2-grupowego:  0.5539335

* 3-grupowego: 0.8915902

* 4-grupowego: 0.9304323

* 6-grupowego: 0.9331214

* 7-grupowego: 0.7003443

Powy¿sze wyniki mówi¹, ¿e podzia³y na 3,4 i 6 grup s¹ bardzo podobne. Dla podzia³u na 7 grup podobieñstwo jest umiarkowane. Podzia³ na dwie grupy nie mo¿na uznaæ na podobny do wyjœciowego.


Mo¿na uznaæ podzia³ na 5 grup na mocy powy¿szych danych za nieuzasadniony, jednak podzia³ na dwie grupy by³by ma³o interesuj¹cy. Natomiast informacje zawarte w tabeli 2 s¹ na tyle interesuj¹ce, ¿e dalsze analizy oprzemy na podziale zbiorowoœci na 5 grup.

<h3>Grupy preferencji</h3>

Celem jest przyjrzenie siê najbardziej i najmniej popularnym stacj¹ dla otrzymanych grup. Czy jest grupa odwiedzaj¹cych maj¹ca unikalny zbiór najczêœciej u¿ytkowanych stacji?


__Uwagi do danych.__ Zauwa¿my, ¿e stacja 29a wystêpuje dla wszystkich grup w zbiorze stacji najrzadziej odwiedzanych. Jest to robot rysuj¹cy obrazy. Nie mo¿na go zatrzymaæ po wystartowaniu. Efektem tego jest  wysoka wartoœæ. œredniego czasu u¿ytkowania stacji, który dla ca³ej populacji wynosi 977 sekund. Zatem rzadkie korzystanie z tej stacji mo¿e wynikaæ z braku technicznej mo¿liwoœci, a nie dlatego, ¿e jest nieatrakcyjna.

W celu zobrazowania danych zawartych w tabeli 2 wykorzystam diagram Venna i wykres punktowy, które przedstawiaj¹ 10 najbardziej popularnych stacji dla poszczególnych grup. Dane umieszczone w diagramie Venna mówi¹ o liczebnoœci podzbioru.
<center>
```{r myfile-3-plot, echo = F, results = 'asis'}
cat('\n![Diagram Venna](diag_venn.png)\n')
```



```{r myfile-4-plot, echo = F, results = 'asis'}
cat('\n![Wykres punktowy](punktowy.png)\n')
```

</center>

```{r, warning=FALSE, eval=FALSE}
library(VennDiagram)
venn.plot <- venn.diagram(
x = Dane_do_Venna,
filename = NULL,
height = 10000,
width=10000,
col = "black",
fill = c("dodgerblue", "goldenrod1", "darkorange1", "seagreen3", "orchid3"),
alpha = 0.50,
cex = c(1.5, 1.5, 1.5, 1.5, 1.5, 1, 0.8, 1, 0.8, 1, 0.8, 1, 0.8,
          1, 0.8, 1, 0.55, 1, 0.55, 1, 0.55, 1, 0.55, 1, 0.55, 1, 1, 1, 1, 1, 1.5),
cat.col = c("dodgerblue", "goldenrod1", "darkorange1", "seagreen3", "orchid3"),
cat.cex = 1.5,
cat.fontface = "bold",
margin = 0.05
);
jpeg("diag_venn_jpeg.jpg");
grid.draw(venn.plot);
dev.off();
```

Co nam mówi¹ informacjê zawarte w tabeli oraz w wykresach?

1. Grupy 1 i 2 maj¹ podobne zestawy stacji najbardziej i najmniej popularnych (6 wspólnych preferowanych stacji). Istotn¹ ró¿nic¹ dla nich s¹ stacje 19a, 19b oraz 25. Stacja 25 jest najczêœciej odwiedzana w grupie 1, natomiast dla grupy 25 jest drug¹ najrzadziej u¿ytkowanych stacj¹(warto tu te¿ nadmieniæ, ¿e stacja 25 nie jest preferowana przez resztê grup. Pod tym wzglêdem grupa 1 jest unikatowa).

2. Grupa 3 posiada tylko 3 preferowane stacje nale¿¹ce grup 1 lub 2. Reszta jest unikatowa w porównaniu z tymi grupami. Natomiast lista stacji najmniej popularnych jest podobna (8 stacji nale¿¹cych do  grup 1 lub 2).

3. Grupa 4 jest najbardziej unikatowa pod wzglêdem preferencji. Posiada 8 preferowanych stacji, któr¹ nie nale¿¹ do zbioru stacji preferowanych przez inne grupy. Podobnie jest ze stacjami najrzadziej odwiedzanymi (6 unikatowych stacji).

4. Grupa 5 ma podobny zbiór preferowanych stacji co grupa 3 (8 tych samych stacji). 
Wnioski. Wœród odwiedzaj¹cych CNK mo¿na rozró¿niæ trzy zbiory eksponatów odwiedzanych przez ró¿ne grupy odwiedzaj¹cych, pod wzglêdem stacji z których najczêœciej korzystaj¹. 

__Wnioski.__ Na podstawie powy¿szego mo¿na rozró¿niæ trzy zbiory eksponatów odwiedzanych przez ró¿ne grupy odwiedzaj¹cych, pod wzglêdem stacji z których najczêœciej korzystaj¹. 

* Pierwszy zbiór eksponatów to najbardziej popularne wspólne stacje dla grup 1 i 2, czyli stacje 02a, 02b, 16, 18, 42a, 61. Wymienione eksponaty nale¿¹ do ró¿nych stref ekspozycji  „Regeneracja”.

* Drugi zbiór to najbardziej popularne stacje dla grupy 4. Pochodz¹ w zdecydowanej wiêkszoœci ze strefy JA MY ONI. Jest to cecha charakterystyczna tej grupy eksponatów.

* Trzeci zbiór to najbardziej popularne wspólne stacje dla grup 3 i 5, czyli stacje 16,12,09,10,17,66,07,05. S¹ to stacje ze strefy JA (oprócz stacji 12). 

<h3>Cechy grup</h3>
Celem jest opis otrzymanych grup. Chcemy sprawdziæ, które cechy s¹ jednorodne, a co odró¿nia otrzymane grupy.

Poni¿szy wykres prezentuje otrzymane grupy pod wzglêdem iloœci odwiedzonych stacji i œredniego czasu korzystania z maszyn
<center>
```{r, echo = F,warning=FALSE}
load(file="populacja.RData")
ggplot(populacja[1000:10000,], aes(x=suma_station, y=average_time, color=grupa)) + geom_point(na.rm=TRUE,show.legend = TRUE)
```

</center>

Wykres wskazuje na umiarkowane rozró¿nienie grup pod wzglêdem iloœci odwiedzanych stacji oraz œredniego czasu spêdzanego przy stacji. Mo¿emy powiedzieæ, ¿e cz³onkowie grupy 1 korzystaj¹ z niewielu stacji (od 1 do 10, œrednio z 3,5 i jest to grupa o najni¿szej takiej œredniej). Mo¿na zaobserwowaæ w grupie 1 podzbiór  osób podchodz¹cych do jednej stacji i spêdzaj¹cych  w nich du¿¹ iloœæ czasu (maks. 2157 sekund). Grupa 5  to osoby odwiedzaj¹ce du¿¹ iloœæ stacji ( od 13 do 49, œrednio 24,43). Ich œredni  czas spêdzany przy stacji nie ró¿ni siê od reszty grup. Jedynie mo¿na zaobserwowaæ, ¿e dla osób, które odwiedzi³y najwiêcej stacji maleje œredni czas spêdzany przy stacji. Widaæ, ¿e czas spêdzany na u¿ytkowaniu stacji nie rozró¿nia otrzymanych grup. 

Powy¿szy wykres sugeruje, ¿eby bardziej szczegó³owo przyjrzeæ siê rozk³adowi liczby odwiedzanych stacji  w rozró¿nieniu na grupy. Rozpatrzmy zatem histogramy rozk³adu iloœci stacji, które u¿yli cz³onkowie poszczególnych grup.


<center>
```{r, echo = F,warning=FALSE}
load(file="tabele_pi.RData")
load(file="plotx5.RData")
source('plot.R')
multiplot(plot1,plot2,cols=1)
multiplot(plot3,plot4,plot5,cols=1)

t6<-rbind(p1,p2,p3,p4,p5)   ## utworzenie tabeli potrzebnej do poni¿szego kodu
ggplot(t6,aes(x=t6$total_sessions))+geom_density(aes(group=t6$grupa,colour=t6$grupa,fill = t6$grupa),alpha=0.3)+scale_y_sqrt()+xlim(0,50)+xlab("Iloœæ odwiedzonych stacji")+ylab("Gêstoœæ") + guides(fill=guide_legend(title="GRUPA"),colour=FALSE)+ggtitle("Rozk³ad liczby odwiedzonych stacji w zale¿noœci od grupy") + annotate("text",x=30,y=0.0075,label="Grupa 5",size=4,colour="red")+annotate("text",x=12,y=0.17,label="Grupa 3",size=4,colour="red")+geom_segment(aes(x = 11, y = 0.15, xend = 10, yend = 0.095))+annotate("text",x=15,y=0.12,label="Grupa 4",size=4,colour="red")+geom_segment(aes(x = 15, y = 0.11, xend = 11, yend = 0.07))+annotate("text",x=2.5,y=0.01,label="Grupa 1",size=4,colour="red",angle=75)+ annotate("text",x=8.5,y=0.21,label="Grupa 2",size=4,colour="red") + geom_segment(aes(x = 8, y = 0.19, xend = 8, yend = 0.09)) + theme(aspect.ratio = 1/2)
```

</center>

```{r, warning=FALSE, eval=FALSE}
load(file="tabele_pi.RData")
library(ggplot2)
ggplot(p1,aes(p1$total_sessions))+geom_bar(aes(y = (..count..)/sum(..count..)),fill="firebrick1",colour="black")+ylab("Gêstoœæ") +xlab("Iloœæ odwiedzonych stacji")+ggtitle("Grupa 1") + scale_x_continuous(breaks=seq(0,12,1)) + coord_cartesian(xlim = c(0, 12))

ggplot(p2,aes(p2$total_sessions))+geom_bar(aes(y = (..count..)/sum(..count..)),fill="firebrick1",colour="black")+ylab("Gêstoœæ") +xlab("Iloœæ odwiedzonych stacji")+ggtitle("Grupa 2") + scale_x_continuous(breaks=seq(0,20,1)) + coord_cartesian(xlim = c(0, 20))

ggplot(p3,aes(p3$total_sessions))+geom_bar(aes(y = (..count..)/sum(..count..)),fill="firebrick1",colour="black")+ylab("Gêstoœæ") +xlab("Iloœæ odwiedzonych stacji")+ggtitle("Grupa 3") + scale_x_continuous(breaks=seq(3,25,1)) + coord_cartesian(xlim = c(3, 25))

ggplot(p4,aes(p4$total_sessions))+geom_bar(aes(y = (..count..)/sum(..count..)),fill="firebrick1",colour="black")+ylab("Gêstoœæ") +xlab("Iloœæ odwiedzonych stacji")+ggtitle("Grupa 4") + scale_x_continuous(breaks=seq(5,28,1)) + coord_cartesian(xlim = c(5, 28))

ggplot(p5,aes(p5$total_sessions))+geom_bar(aes(y = (..count..)/sum(..count..)),fill="firebrick1",colour="black")+ylab("Gêstoœæ") +xlab("Iloœæ odwiedzonych stacji")+ggtitle("Grupa 4")+ scale_x_continuous(breaks=seq(14,48,1)) + coord_cartesian(xlim = c(14, 48))
```

Z powy¿szego mo¿emy powiedzieæ, ¿e

* Do grupy 1 nale¿¹ osoby odwiedzaj¹cy nisk¹ liczbê stacji, a¿ 40% tej zbiorowoœci odwiedza tylko jedn¹ lub dwie stacje. 

* W porównaniu do grupy 1 dominanta dla grupy 2 jest ju¿ przesuniêta do punktu 5 , a zakres liczby odwiedzanych stacji jest szerszy. Osoby, które podchodz¹ do od jednej do piêciu stacji stanowi¹ 50% tej grupy. Zauwa¿my, ¿e procent osób odwiedzaj¹cych n stacji dla n=2,3,4,5,6 utrzymuje siê na podobnym poziomie i wynosi oko³o 10%.

* Osoby z grup 3 i 4 podchodz¹ zdecydowanie czêœciej ni¿ zwiedzaj¹cy z poprzednich grup. W tych grupach wystêpuj¹ zbli¿one wartoœci œredniej liczby odwiedzonych stacji (12 dla 3 i 12,8 dla 4). Histogramy dla tych grup maj¹ podobny kszta³t. Najwiêcej osób z grupy 3 podchodzi do 11 stacji, a z grupy 4 do 10. Mo¿na uznaæ, ¿e liczba odwiedzanych stacji nie odró¿nia znacznie tych dwóch klastrów.

* Osoby z grupy 5 odwiedzaj¹ najwiêcej stacji. Œrednia wynosi  24,3 dominanta 21,a zakres od 14 do 52. Kszta³t histogramu jest te¿ unikalny dla tej grupy.

* Warto odnotowaæ, ¿e ze wzrostem liczby odwiedzanych stacji roœnie w grupie odsetek osób odwiedzaj¹cych CNK w weekend  

<h3>Charakterystyka stacji</h3>

Teraz chcemy scharakteryzowaæ najbardziej popularne stacje dla poszczególnych grup.  

Rozwa¿my ich rozmieszczenie. Mapka poni¿ej prezentuje rozmieszczenie najbardziej popularnych stacji dla rozwa¿anych grup.  

<center>
```{r myfile-5-plot, echo = F, results = 'asis'}
cat('\n![Mapa CNK](Mapa_CNK.png)\n')
```

</center>


Widzimy, ¿e dla grup 3,4,5 najbardziej popularne stacje s¹ zlokalizowane s¹ blisko siebie.  Ta bliskoœæ potwierdza obserwacje, ¿e najbardziej popularne stacje dla tych grup zlokalizowane s¹ w tych samych strefach. Charakterystyczna znów jest grupa 4, dla której stacje zlokalizowane s¹ w innej czêœci ekspozycji ni¿ dla grup 3 i 4( w g³êbi wystawy). Przypominam, ¿e tylko osoby z grupy 4 preferowali stacje ze strefy JA MY ONI.  Dla grup 1 i 2 obserwujemy rozmieszczenie najbardziej popularnych stacji po ca³ej ekspozycji. Widzimy du¿e zainteresowanie eksponatami znajduj¹cymi siê przy wejœciu do ekspozycji oraz niskie dla tych znajduj¹cych siê w g³êbi.

Nasuwaj¹ siê nastêpuj¹ce obserwacje. Wystêpuje du¿e zagêszczenie najbardziej ulubionych stacji przy wejœciu do „Regeneracji”, a stacje w g³êbi preferowane s¹ tylko przez jedn¹ grupê. Nie ma grup preferuj¹cy stacje ze stref JA TY oraz JA ŒWIAT.

```{r myfile-19-plot, echo = F, results = 'asis'}
cat('\n![ ](enter.png)\n')
```

#Podsumowanie 1 czêœci

1. Dwoma metodami analizy korespondencji stwierdziliœmy istnienie zale¿noœci miêdzy podgrupami zwiedzaj¹cych, a stacjami i strefami. Wyniki te skonfrontowaliœmy z histogramami popularnoœæ stacji i stref dla poszczególnych podgrup zwiedzaj¹cych, które potwierdzi³y poprawnoœæ wyników. Wyniki wszystkich metod s¹ spójne.
 
2. Metody analizy korespondencji wskaza³y, ¿e za zró¿nicowanie miêdzy podgrupami zwiedzaj¹cych odpowiedzialne s¹ stacje 25 i 19a oraz strefy JA-TY i JA-MY-ONI.

#Podsumowanie 2 czêœci

1. Dla stref JA oraz JA-MY-ONI istniej¹ grupy odwiedzaj¹cych preferuj¹cy tylko te konkretne strefy (grupy 3 i 5 dla strefy JA oraz grupa 4 dla strefy JA-MY-ONI). Mo¿na sdziæ, ¿e strefy te „trafiaj¹” do konkretnych typów odwiedzaj¹cych. 

2. Mapka wskazuje, ¿e dla grup 3 i 5 najczêœciej odwiedzane stacje znajduj¹ siê przy wejœciu na ekspozycje. Wysoka wartoœæ iloœci odwiedzanych stacji dla tych grup prowadziæ do wniosku, ¿e du¿e zagêszczenie stacji przy wejœciu mo¿e prowadziæ do wyczerpania przeznaczonego czasu na zwiedzanie tylko na stacje ze strefy JA i tym samym brak zainteresowania dalszymi stacjami.

3. Grupa 4 nie jest zainteresowana stacjami znajduj¹cymi siê przy wejœciu do ekspozycji (strefa JA). Czas spêdza na eksponatach ze strefy JA-MY-ONI. Mo¿e to sugerowaæ, ¿e s¹ to osoby, które maj¹ wiedze o istnieniu takiej strefy i jej eksponatów. Mo¿e s¹ to osoby odwiedzaj¹ce CNK kilka razy i powracaj¹ do niego ze wzglêdu na zainteresowanie stacjami ze strefy JA-MY-ONI.

4. Osoby o niskiej liczbie odwiedzonych stacji (grupa 1 i 2) odwiedzaj¹ stacje z ca³ej ekspozycji, choæ zdecydowana wiêkszoœæ znajdujê siê w strefie JA.

#Podsumowanie do ca³oœci

Dla uporz¹dkowania dokonajmy nastêpuj¹cych oznaczeñ:

* 1.1 - grupa osób z czêœci pierwszej, którzy odwiedzili 1 lub 2 stacje

* 1.2 -  grupa osób z czêœci pierwszej, którzy odwiedzili od 3 lub 5 stacji

* 1.3 -  grupa osób z czêœci pierwszej, którzy odwiedzili od 6 lub 9 stacji

* 1.4 -  grupa osób z czêœci pierwszej, którzy odwiedzili co najmniej 10 stacji

* 2.1 – grupa z drugiej czêœci, oznaczona wczeœniej cyfr¹ 1

* 2.2 – grupa z drugiej czêœci, oznaczona wczeœniej cyfr¹ 2

* 2.3 – grupa z drugiej czêœci, oznaczona wczeœniej cyfr¹ 3

* 2.4 – grupa z drugiej czêœci, oznaczona wczeœniej cyfr¹ 4

* 2.5 – grupa z drugiej czêœci, oznaczona wczeœniej cyfr¹ 5

###Przeprowadzone analizy i porównanie dwóch rozwa¿anych podzia³ów prowadz¹ do nastêpuj¹cych wniosków:

1. Osoby z grupy 1.1 w ujêciu procentowym czêœciej korzystaj¹ ze strefy JA-TY, ni¿ pozosta³e grupy 1.2, 1.3, 1.4. Osoby z tej grupy podchodz¹ do 1 lub 2 stacji. Grupê tê mo¿na uto¿samiæ z grup¹ 2.1. Na mocy tego t³umaczy siê dlaczego 2 stacje (25 i 18) ze strefy JA-TY nale¿¹ do zbioru 10 najbardziej popularnych stacji grupy 2.2. Tylko grupa 2.2 ma a¿ dwie takie stacje. Tak samo ujemne skorelowanie grupy 1.1 ze stref¹ JA-MY-ONI t³umaczy dlaczego, a¿ 7 stacji z tej strefy nale¿y do zbioru stacji najmniej popularnych dla grupy 2.1

2. Dla grup 1.1 oraz 1.2 wystêpuje du¿a wartoœæ reszty Pearsonowskich dla stacji 19a oraz 25. Bior¹c pod uwagê liczbê odwiedzonych stacji mo¿na s¹dziæ, ¿e stacje 1.1, 1.2 oraz 2.1, 2.2 s¹ ze sob¹ powi¹zane (du¿a liczba wspólnych odwiedzaj¹cych). To t³umaczy dlaczego stacja 25 jest najbardziej popularna dla grupy 2.1, a stacja 19a najbardziej popularna dla grupy 2.2.


###Propozycje wynikaj¹ce z obserwacji

1. Zastanowiæ, czy du¿a iloœæ stacji przy wejœciu na ekspozycje nie zaburza równowagi w interakcji z ca³oœci¹ ekspozycji.

2. Rozwa¿yæ umieszczenie, przy wejœciu na ekspozycje, informacji o znajduj¹cych siê w niej eksponatach wraz z opisem, tak by zwiedzaj¹cy wybra³ czeœæ najbardziej mu odpowiadaj¹c¹.

3. Strefy JA oraz JA-MY-ONI s¹ preferowane przez pewne podgrupy zwiedzaj¹cych. Zastanowiæ siê dlaczego nie ma takiego zbioru odwiedzaj¹cych dla stref JA-TY oraz JA-ŒWIAT. Czy da siê udoskonaliæ te strefy tak by wyodrêbni³y siê takie grupy?


#Dodatek

###Popularnoœæ stacji w podziale na podgrupy

<center>
```{r, echo = F,warning=FALSE}
load(file="stacjex4.RData")
load(file="tabele_stacjex4.RData")
source('plot.R')
multiplot(stacje1,stacje2,cols=1)
multiplot(stacje3,stacje4,cols=1)
```

</center>

Mo¿na zauwa¿yæ, ¿e gdy jakaœ osoba odwiedzi³a tylko jedn¹ stacjê, to jest to zazwyczaj stacja 19a lub stacja 25. Dla kolejnych grup zwiedzaj¹cych 19a nadal jest jedn¹ z najbardziej popularnych stacji, a stacja 25 w innych grupach nie jest ju¿ tak popularna. Mo¿na te¿ zauwa¿yæ, ¿e wraz ze wzrostem liczby odwiedzanych stacji przez jednego zwiedzaj¹cego, nastêpuje upodabnianie siê powy¿szych rozk³adów do rozk³adu jednostajnego.

###Popularnoœæ stref w podziale na podgrupy
<center>
```{r, echo = F,warning=FALSE}
load(file="strefyx4.RData")
load(file="tabele_strefyx4.RData")
source('plot.R')

multiplot(strefy1,strefy2,cols=1)
multiplot(strefy3,strefy4,cols=1)
```

</center>

Patrz¹c na wykresy dla tych czterech grup mo¿emy powiedzieæ, ¿e rozk³ad podejœæ do stacji z poszczególnych stref nie ró¿ni siê zbytnio dla grup o ró¿nych liczbach stacji zwiedzonych przez jednego zwiedzaj¹cego. Jedn¹ z ró¿nic jest wiêksza popularnoœæ strefy Ja-Ty w grupie “1”, ni¿ w pozosta³ych grupach. Przyczyn¹ tej ró¿nicy jest zaobserwowana wczeœniej du¿a popularnoœæ, znajduj¹cej siê w tej strefie stacji 25. Mo¿na te¿ zauwa¿yæ, ¿e popularnoœæ strefy Ja-My-Oni roœnie, bior¹c pod uwagê kolejne podgrupy.

Poni¿szy kod tworzy histogramy "Popularnoœæ stacji", "Popularnoœæ stref" znajduj¹ce siê na pocz¹tku pierwszej czêœci projektu oraz powy¿sze histogramy z Dodatku.

> Wyjœciowe dane do pierwszej czêœci projektu to tabela: tabela_station_strefa_sort_b, zawiera ona informacje, czy dany zwiedzaj¹cy podszed³ do poszczególnych stacji. 

```{r, warning=FALSE, eval=FALSE}
library(dplyr)
library(ggplot2)

load(file="tabela_station_strefa_sort_b.RData")
tab_bin_zsuma<-tabela_station_strefa_sort_b
#dodanie kolumny z sum¹
tab_bin_zsuma$suma<-rowSums(sapply(tabela_station_strefa_sort_b[,2:58],as.numeric))

nazwy<-c("02a","02b","03","05","06","07","09","10",
         "11","13","16a","17","19a","19b","20","21","66","67",
         "12","32","39","40","42a","43","44","45","49","55","56",
         "57","58b","59","60","61","62","69","71","72","73","79","100","37",
         "38","46a","46b","47","48a","75","18a","22",
         "23","25","26","29a","78a","36","63a")

tab_bin_zsuma[,2:58] <- sapply(tab_bin_zsuma[,2:58] , as.numeric)

#popularnoœæ stacji ogó³em
colSums(tab_bin_zsuma[,2:58])->
  popularnosc_stacji
names(popularnosc_stacji)<-nazwy


popularnosc_stacji_tab <- data.frame(popularnosc_stacji)
popularnosc_stacji_tab[,2]<-names(popularnosc_stacji)
row.names(popularnosc_stacji_tab) <- 1:57

ggplot(popularnosc_stacji_tab,aes(y=popularnosc_stacji_tab$popularnosc_stacji,x=popularnosc_stacji_tab$V2))+geom_bar(stat="identity", fill="royalblue2") + scale_y_continuous(breaks=seq(0,50000,10000))+ xlab("Stacje") +ylab("Iloœæ zwiedzaj¹cych")+ggtitle("Iloœæ zwiedzaj¹cych z podzia³em na stacje")+theme(axis.text.x = element_text(angle = 90, hjust = 1))

#popularnoœæ stref ogó³em
pop_ja<-popularnosc_stacji[1:18]
pop_ja_my_oni<-popularnosc_stacji[19:41]
pop_ja_swiat<-popularnosc_stacji[42:48]
pop_ja_ty<-popularnosc_stacji[49:55]


wektor<-c(sum(pop_ja),sum(pop_ja_my_oni),sum(pop_ja_swiat),sum(pop_ja_ty))

nazwy_stref = c("Ja","Ja-My-Oni","Ja-Œwiat","Ja-Ty")
wektor_tab <- data.frame(wektor)
wektor_tab[ ,2]<- nazwy_stref

ggplot(wektor_tab,aes(x=wektor_tab$V2,y=wektor_tab$wektor))+geom_bar(stat="identity",fill="royalblue2",colour="black") +xlab("Strefy") + ylab("Iloœæ zwiedzaj¹cych") + ggtitle("Liczba zwiedzaj¹cych z podzia³em na strefy ogó³em")+ geom_text(aes(label=wektor_tab$wektor), vjust=1.1)

#zwiedzaj¹cy, którzy podchodz¹ od 1 do 2 eksponatow
tab_bin_zsuma %>%
  filter(suma>0, suma<3)->
  tab_bin_1_do_2

colSums(tab_bin_1_do_2[,2:58])->rozklad_dla_1do2

rozklad_dla_1do2tab <- data.frame(rozklad_dla_1do2)
rozklad_dla_1do2tab[ ,2] <- names(rozklad_dla_1do2)

#oœ Y zosta³a przeskalowana pierwiastkiem w ponizszym wykresie (na samym koncu linijki)
ggplot(rozklad_dla_1do2tab,aes(x=rozklad_dla_1do2tab$V2,y=rozklad_dla_1do2tab$rozklad_dla_1do2))+geom_bar(stat="identity", fill="#F8766D") + xlab("Stacje") +ylab("Iloœæ zwiedzaj¹cych")+ggtitle("Dla odwiedzaj¹cych od 1 do 2 stacji")+theme(axis.text.x = element_text(angle = 90, hjust = 1)) +scale_y_sqrt()

roz1do2_ja<-rozklad_dla_1do2[1:18]
roz1do2_ja_my_oni<-rozklad_dla_1do2[19:41]
roz1do2_ja_swiat<-rozklad_dla_1do2[42:48]
roz1do2_ja_ty<-rozklad_dla_1do2[49:55]


wektor1<-c(sum(roz1do2_ja),sum(roz1do2_ja_my_oni),sum(roz1do2_ja_swiat),sum(roz1do2_ja_ty))

nazwy_stref = c("Ja","Ja-My-Oni","Ja-Œwiat","Ja-Ty")
wektor1_tab <- data.frame(wektor1)
wektor1_tab[ ,2]<- nazwy_stref

ggplot(wektor1_tab,aes(x=wektor1_tab$V2,y=wektor1_tab$wektor1))+geom_bar(stat="identity",fill="#F8766D",colour="black") +xlab("Strefy") + ylab("Iloœæ zwiedzaj¹cych") + ggtitle("Dla odwiedzaj¹cych od 1 do 2 stacji")+ geom_text(aes(label=wektor1_tab$wektor), vjust=1.1)

#zwiedzaj¹cy, którzy podchodz¹ do 3-5 eksponatów 
tab_bin_zsuma %>%
  filter(suma>2, suma<6)->
  tab_bin_od3do5

colSums(tab_bin_od3do5[,2:58])->rozklad_dla_od3do5

rozklad_dla_3do5tab <- data.frame(rozklad_dla_od3do5)
rozklad_dla_3do5tab[ ,2] <- names(rozklad_dla_od3do5)
row.names(rozklad_dla_3do5tab) <- 1:57

ggplot(rozklad_dla_3do5tab,aes(x=rozklad_dla_3do5tab$V2,y=rozklad_dla_3do5tab$rozklad_dla_od3do5))+geom_bar(stat="identity", fill="#7CAE00") + xlab("Stacje") +ylab("Iloœæ zwiedzaj¹cych")+ggtitle("Dla odwiedzaj¹cych od 3 do 5 stacji")+theme(axis.text.x = element_text(angle = 90, hjust = 1)) +scale_y_sqrt()


roz35_ja<-rozklad_dla_od3do5[1:18]
roz35_ja_my_oni<-rozklad_dla_od3do5[19:41]
roz35_ja_swiat<-rozklad_dla_od3do5[42:48]
roz35_ja_ty<-rozklad_dla_od3do5[49:55]


wektor2<-c(sum(roz35_ja),sum(roz35_ja_my_oni),sum(roz35_ja_swiat),sum(roz35_ja_ty))

wektor2_tab <- data.frame(wektor2)
wektor2_tab[ ,2]<- nazwy_stref

ggplot(wektor2_tab,aes(x=wektor2_tab$V2,y=wektor2_tab$wektor2))+geom_bar(stat="identity",fill="#7CAE00",colour="black") +xlab("Strefy") + ylab("Iloœæ zwiedzaj¹cych") + ggtitle("Dla odwiedzaj¹cych od 3 do 5 stacji")+ geom_text(aes(label=wektor2_tab$wektor), vjust=1.1)

#zwiedzaj¹cy, którzy podchodz¹ do 6-9eksponatów q
tab_bin_zsuma %>%
  filter(suma>5, suma<10)->
  tab_bin_od6do9

colSums(tab_bin_od6do9[,2:58])->rozklad_dla_od6do9


rozklad_dla_6do9tab <- data.frame(rozklad_dla_od6do9)
rozklad_dla_6do9tab[ ,2] <- names(rozklad_dla_od6do9)


ggplot(rozklad_dla_6do9tab,aes(x=rozklad_dla_6do9tab$V2,y=rozklad_dla_6do9tab$rozklad_dla_od6do9))+geom_bar(stat="identity", fill="#00BFC4") + xlab("Stacje") +ylab("Iloœæ zwiedzaj¹cych")+ggtitle("Dla odwiedzaj¹cych od 6 do 9 stacji")+theme(axis.text.x = element_text(angle = 90, hjust = 1)) +scale_y_sqrt()


roz69_ja<-rozklad_dla_od6do9[1:18]
roz69_ja_my_oni<-rozklad_dla_od6do9[19:41]
roz69_ja_swiat<-rozklad_dla_od6do9[42:48]
roz69_ja_ty<-rozklad_dla_od6do9[49:55]


wektor3<-c(sum(roz69_ja),sum(roz69_ja_my_oni),sum(roz69_ja_swiat),sum(roz69_ja_ty))


wektor3_tab <- data.frame(wektor3)
wektor3_tab[ ,2]<- nazwy_stref

ggplot(wektor3_tab,aes(x=wektor3_tab$V2,y=wektor3_tab$wektor3))+geom_bar(stat="identity",fill="#00BFC4",colour="black") +xlab("Strefy") + ylab("Iloœæ zwiedzaj¹cych") + ggtitle("Dla odwiedzaj¹cych od 6 do 9 stacji")+ geom_text(aes(label=wektor3_tab$wektor), vjust=1.1)

#zwiedzaj¹cy, którzy podchodz¹ do conajmniej 10 eksponatów q
tab_bin_zsuma %>%
  filter(suma>9)->
  tab_bin_od10

colSums(tab_bin_od10[,2:58])->rozklad_dla_od10

rozklad_dla_od10tab <- data.frame(rozklad_dla_od10)
rozklad_dla_od10tab[ ,2] <- names(rozklad_dla_od10)

ggplot(rozklad_dla_od10tab,aes(x=rozklad_dla_od10tab$V2,y=rozklad_dla_od10tab$rozklad_dla_od10))+geom_bar(stat="identity", fill="#C77CFF") + xlab("Stacje") +ylab("Iloœæ zwiedzaj¹cych")+ggtitle("Dla odwiedzaj¹cych od co najmniej 10 stacji")+theme(axis.text.x = element_text(angle = 90, hjust = 1)) +scale_y_sqrt()
library(ggplot2)

roz10_ja<-rozklad_dla_od10[1:18]
roz10_ja_my_oni<-rozklad_dla_od10[19:41]
roz10_ja_swiat<-rozklad_dla_od10[42:48]
roz10_ja_ty<-rozklad_dla_od10[49:55]


wektor4<-c(sum(roz10_ja),sum(roz10_ja_my_oni),sum(roz10_ja_swiat),sum(roz10_ja_ty))


nazwy_stref = c("Ja","Ja-My-Oni","Ja-Œwiat","Ja-Ty")
wektor4_tab <- data.frame(wektor4)
wektor4_tab[ ,2]<- nazwy_stref

ggplot(wektor4_tab,aes(x=wektor4_tab$V2,y=wektor4_tab$wektor4))+geom_bar(stat="identity",fill="#C77CFF",colour="black") +xlab("Strefy") + ylab("Iloœæ zwiedzaj¹cych") + ggtitle("Dla odwiedzaj¹cych od co najmniej 10 stacji")+ geom_text(aes(label=wektor4_tab$wektor), vjust=1.1)


#kolory:
#"#F8766D" "#7CAE00" "#00BFC4" "#C77CFF"
```


####G³ówny wk³ad:
_Dominik Ambroziak_: wymyœli³ i opracowa³ pierwsz¹ czêœæ projektu.

_Mateusz Jastrz¹b_: wykona³ wszystkie histogramy ggplot w pierwszej czêœci i Dodatku oraz jeden "Rozk³ad liczby odwiedzonych stacji w zale¿noœci od grupy" w drugiej czêœci.

_Patrycja Matys_: opracowanie pierwszej czêœci projektu, zarz¹dzanie i umieszczenie wszystkich wyników w knitr.

_Kamil Wirtek_: wymyœli³ i samodzielnie opracowa³ drug¹ czêœæ projektu.
